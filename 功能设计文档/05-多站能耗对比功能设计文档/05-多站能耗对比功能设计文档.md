# 多站能耗对比功能设计文档

UI设计地址：https://www.figma.com/design/k5TBKzoZJ0DPn5LobyEc20/%E9%AB%98%E9%93%81%E7%AB%99%E8%83%BD%E8%80%97%E6%BC%94%E7%A4%BA?node-id=22-4256&m=dev

## 1. 概述

### 1.1 功能简介

多站能耗对比功能允许用户选择多个高铁站，对它们的能耗数据进行全面对比分析，帮助发现节能潜力。该功能通过可视化图表展示不同站点在总能耗、能耗趋势、能耗结构和单位面积能耗等方面的差异，为节能策略制定提供依据。

### 1.2 应用场景

- 能源管理部门定期进行站点能耗对比分析
- 节能项目启动前的站点能耗基准评估
- 运营管理中的跨站点节能经验分享
- 能源效率评估与排名

### 1.3 目标用户

- 能源管理专家
- 运营管理人员
- 节能项目决策者

### 1.4 关键指标

- 支持同时对比分析的站点数量：2-8个
- 支持的时间维度：日、周、月
- 支持的能源类型：总能耗、电力、燃气、水

## 2. 功能架构

```
多站能耗对比
├── 页面标题模块
│   ├── 模块标题展示
│   └── 功能描述
├── 筛选条件模块
│   ├── 站点选择
│   ├── 时间范围选择
│   ├── 能源类型选择
│   ├── 对比分析按钮
│   └── 重置按钮
├── 对比概览模块
│   ├── 站点概览卡片
│   ├── 总能耗指标
│   ├── 单位面积能耗指标
│   ├── 同比变化指标
│   └── 环比变化指标
├── 对比图表模块
│   ├── 总能耗对比柱状图
│   ├── 能耗趋势对比线图
│   ├── 能耗结构对比饼图
│   └── 单位面积能耗对比横向柱状图
└── 对比结果分析模块
    ├── 能耗水平排名表
    └── 节能潜力分析时间线
```

## 3. 详细设计

### 3.1 页面标题模块

**组件名称：** PageHeader  
**功能描述：** 展示页面标题和简要功能说明  
**属性：**
- `title`：页面标题
- `description`：功能描述文本

**交互：**
- 无交互行为

### 3.2 筛选条件模块

**组件名称：** FilterPanel  
**功能描述：** 提供站点、时间范围和能源类型选择，并提供查询和重置功能  
**属性：**
- `stationOptions`：可选站点列表
- `selectedStations`：已选站点数组
- `dateRange`：时间范围数组
- `energyType`：选中的能源类型
- `onFilter`：筛选事件处理函数
- `onReset`：重置事件处理函数

**交互：**
- 站点选择：支持多选，默认选中4个站点
- 时间范围：支持自定义时间区间选择
- 能源类型：支持选择总能耗或具体能源类型
- 对比分析：点击后触发数据查询和图表更新
- 重置：将所有条件恢复到默认值

### 3.3 对比概览模块

**组件名称：** StationOverview  
**功能描述：** 展示每个选中站点的关键能耗指标  
**属性：**
- `selectedStations`：已选站点数组
- `stationData`：站点能耗数据对象
- `getStationName`：获取站点名称函数
- `getStationMetric`：获取站点指标函数
- `getTrendClass`：获取趋势样式函数

**交互：**
- 鼠标悬停：卡片轻微上浮效果
- 无直接交互操作

### 3.4 对比图表模块

**组件名称：** ComparisonCharts  
**功能描述：** 展示多种类型的对比图表  
**属性：**
- `selectedStations`：已选站点数组
- `dateRange`：时间范围
- `energyType`：能源类型
- `trendTimeInterval`：趋势时间间隔
- `stationData`：站点能耗数据
- `getStationName`：获取站点名称函数
- `getTrendXAxis`：获取趋势图表X轴数据函数
- `getTrendDataByInterval`：获取趋势图表数据函数
- `palette`：图表颜色数组
- `getColor`：获取颜色函数

**交互：**
- 图表类型切换：趋势图表支持日/周/月时间间隔切换
- 窗口大小变化：图表自适应调整大小
- 图表交互：支持鼠标悬停显示详细数据

### 3.5 对比结果分析模块

**组件名称：** AnalysisResults  
**功能描述：** 展示站点能耗排名和节能潜力分析  
**属性：**
- `selectedStations`：已选站点数组
- `stationData`：站点能耗数据
- `getStationName`：获取站点名称函数
- `stationRanking`：站点能耗排名计算属性
- `energySavingPotential`：节能潜力分析计算属性

**交互：**
- 表格排序：点击列标题支持排序
- 折叠面板：节能潜力分析支持展开/收起

## 4. 数据结构

### 4.1 站点选项数据结构

```javascript
// 站点选项数据结构
{
  label: '北京南站', // 站点显示名称
  value: 'beijing'   // 站点标识符
}
```

### 4.2 站点能耗数据结构

```javascript
// 站点能耗数据结构
{
  totalEnergy: 1256000,              // 总能耗
  energyPerArea: 85.6,               // 单位面积能耗(kWh/m²)
  yearOnYear: -5.2,                  // 同比变化(%)
  monthOnMonth: 2.8,                 // 环比变化(%)
  energyStructure: [                  // 能耗结构
    { name: '电力', value: 785000 },
    { name: '燃气', value: 285000 },
    { name: '水', value: 186000 }
  ],
  dailyTrend: [38000, ...],          // 日趋势数据(31天)
  monthTrend: [24500, ...]           // 月趋势数据(6个月)
}
```

### 4.3 站点排名数据结构

```javascript
// 站点排名数据结构
{
  rank: 1,                     // 排名
  station: '北京南站',         // 站点名称
  totalEnergy: 1256000,        // 总能耗
  energyPerArea: 85.6,         // 单位面积能耗
  yearOnYear: -5.2             // 同比变化
}
```

### 4.4 节能潜力数据结构

```javascript
// 节能潜力数据结构
{
  station: '北京南站',               // 站点名称
  title: '北京南站节能潜力分析',      // 分析标题
  description: '通过对比分析...',     // 分析描述
  potential: 188400                 // 预计节能潜力(kWh/年)
}
```

## 5. 接口设计

### 5.1 获取站点列表

**接口名称：** `getStationOptions`  
**请求参数：**
- 无

**返回数据：**
```javascript
[
  { label: '北京南站', value: 'beijing' },
  { label: '上海虹桥站', value: 'shanghai' },
  ...
]
```

### 5.2 获取站点能耗数据

**接口名称：** `getStationEnergyData`  
**请求参数：**
```javascript
{
  stations: ['beijing', 'shanghai', ...],  // 站点标识符数组
  startDate: '2024-01-01',                 // 开始日期
  endDate: '2024-01-31',                   // 结束日期
  energyType: 'total'                      // 能源类型
}
```

**返回数据：**
```javascript
{
  beijing: {
    totalEnergy: 1256000,
    energyPerArea: 85.6,
    yearOnYear: -5.2,
    monthOnMonth: 2.8,
    energyStructure: [...],
    dailyTrend: [...],
    monthTrend: [...]
  },
  shanghai: {...},
  ...
}
```

### 5.3 获取节能潜力分析

**接口名称：** `getEnergySavingPotential`  
**请求参数：**
```javascript
{
  stations: ['beijing', 'shanghai', ...]  // 站点标识符数组
}
```

**返回数据：**
```javascript
[
  {
    station: '北京南站',
    title: '北京南站节能潜力分析',
    description: '通过对比分析，北京南站的单位面积能耗高于行业平均水平5.2%，主要体现在空调系统能耗过高',
    potential: 188400
  },
  ...
]
```

## 6. 异常处理

### 6.1 数据加载异常

**场景：** 获取站点数据失败  
**处理：**
- 显示错误提示消息
- 提供重试按钮
- 记录错误日志

### 6.2 无数据异常

**场景：** 选中站点无对应数据  
**处理：**
- 显示"暂无数据"提示
- 提示用户重新选择站点或调整时间范围
- 保持界面布局，避免布局抖动

### 6.3 图表渲染异常

**场景：** 图表初始化或更新失败  
**处理：**
- 显示图表加载失败提示
- 提供刷新按钮
- 降级显示数据表格

### 6.4 参数校验异常

**场景：** 用户输入无效参数  
**处理：**
- 表单字段实时校验
- 明确的错误提示信息
- 阻止无效请求发送

## 7. 性能优化

### 7.1 图表渲染优化

- 使用`requestAnimationFrame`确保DOM渲染后再初始化图表
- 图表实例复用，避免重复创建销毁
- 窗口大小变化时使用`resize`方法而非重新创建图表

### 7.2 数据处理优化

- 使用Vue3 Composition API的`computed`属性缓存计算结果
- 使用`watch`监听依赖变化，仅更新相关图表
- 大数据集采用抽样或分段加载策略

### 7.3 交互优化

- 添加加载状态指示器
- 优化动画效果，避免影响性能
- 响应式设计确保在各种设备上的良好体验

## 8. 兼容性设计

### 8.1 浏览器兼容性

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

### 8.2 屏幕尺寸兼容性

- 桌面端（≥1280px）：完整布局
- 平板端（768-1279px）：适当调整列数和间距
- 移动端（<768px）：堆叠布局，优化触摸交互

## 9. 可扩展性设计

### 9.1 图表类型扩展

- 采用ECharts图表库，支持多种图表类型
- 预留图表容器，支持新增图表类型

### 9.2 数据维度扩展

- 数据结构设计支持新增能源类型
- 接口设计支持扩展时间维度

### 9.3 站点数据扩展

- 站点数据接口支持分页加载
- 支持站点自定义属性扩展